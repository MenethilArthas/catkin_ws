#!/usr/bin/env python
# -*- coding: utf-8 -*-
import struct
import rospy
from serial import Serial
import time
import math

from ctypes import *
from std_msgs.msg import Int16,Int32,Int64,Float32,Float64,String,UInt64
from geometry_msgs.msg import Twist

unlocking = 0
ly = 0
az = 0


def Update_Speed(twist):
	global unlocking 
	global ly
	global az
	ly=int(twist.linear.y)
	az=int(test.angular.z)
	unlocking=1
def listener():
	ser = serial.Serial('/dev/ttyUSB0',115200,timeout=1)
	motor_speed = rospy.Subscriber('turtlebot_teleop/cmd_vel',Twist,Update_Speed)
	global unlocking
	rospy.init_node('listener',anonymous=True)
	r=rospy.Rate(50)
	while not rospy.is_shutdown():

		if unlocking ==1:
			ser.write('A')
			ser.write('C')
			ser.write(struct.pack('<h',ly))
			ser.write(struct.pack('<h',az))
			unlocking =0
		r.sleep()

if __name__=='__main__':
	listener()

